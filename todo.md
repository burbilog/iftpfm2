# TODO: Code Review Fixes

> 22 –≤–∞–ª–∏–¥–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞ –∏–∑ codereview.md, —Ç—Ä–µ–±—É—é—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (3 –ø—É–Ω–∫—Ç–∞)

- [x] **#1** –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å (`ftp_ops.rs`)
  - –°–µ–π—á–∞—Å: `Vec::new()` + `read_to_end()` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª –≤ RAM
  - –ù–∞–¥–æ: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å streaming ‚Äî pipe –º–µ–∂–¥—É `retr` –∏ `put_file` –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `tempfile::NamedTempFile` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –¥–∏—Å–∫ –≤–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ RAM
  - –§–∞–π–ª: `src/ftp_ops.rs:358-390`

- [x] **#3** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —É—Ç–∏–ª–∏—Ç `lsof` –∏ `kill` (`instance.rs`)
  - –°–µ–π—á–∞—Å: `Command::new("lsof")` –∏ `Command::new("kill")` –¥–ª—è PID
  - –ù–∞–¥–æ: –ß–∏—Ç–∞—Ç—å PID –∏–∑ lock-—Ñ–∞–π–ª–∞ (—É–∂–µ –ø–∏—à–µ—Ç—Å—è), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `nix::sys::signal::kill` –∏–ª–∏ `libc::kill`
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: PID —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞, —Å–∏–≥–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `nix` crate
  - –§–∞–π–ª: `src/instance.rs:21-104`

- [x] **#4** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ –Ω–∞ SFTP Session (`sftp.rs`)
  - –°–µ–π—á–∞—Å: –¢–∞–π–º–∞—É—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ TCP stream, `Session::set_timeout()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
  - –ù–∞–¥–æ: –î–æ–±–∞–≤–∏—Ç—å `session.set_timeout(timeout)` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –î–æ–±–∞–≤–ª–µ–Ω `session.set_timeout(timeout.as_millis() as u32)` –ø–æ—Å–ª–µ handshake
  - –§–∞–π–ª: `src/protocols/sftp.rs:67-82`

---

## üü† –°–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (4 –ø—É–Ω–∫—Ç–∞)

- [x] **#5** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ `Client` enum (`protocols/mod.rs`)
  - –°–µ–π—á–∞—Å: 11 –º–µ—Ç–æ–¥–æ–≤ —Å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏ match patterns –ø–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
  - –ù–∞–¥–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å `delegate!` –∏–ª–∏ crate `enum_dispatch`
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –°–æ–∑–¥–∞–Ω –º–∞–∫—Ä–æ—Å `delegate!` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - –§–∞–π–ª: `src/protocols/mod.rs:118-122, 183-244`

- [x] **#6** –ú–∞—Å—Å–∏–≤–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ rename-–ª–æ–≥–∏–∫–∏ (`ftp_ops.rs`)
  - –°–µ–π—á–∞—Å: ~35 —Å—Ç—Ä–æ–∫ √ó 2 –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω—ã–π rename –∏ fallback)
  - –ù–∞–¥–æ: –í—ã–Ω–µ—Å—Ç–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é `handle_successful_rename()`
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_successful_rename()` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - –§–∞–π–ª: `src/ftp_ops.rs:96-139`

- [x] **#7** –§—É–Ω–∫—Ü–∏—è `transfer_files` –Ω–∞ 517 —Å—Ç—Ä–æ–∫ (`ftp_ops.rs`)
  - –°–µ–π—á–∞—Å: –û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ (connect, login, cwd, list, transfer, verify, rename, delete)
  - –ù–∞–¥–æ: –î–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–µ–Ω—å—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –°–æ–∑–¥–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `connect_and_login()` –∏ `check_file_should_transfer()`
  - –§—É–Ω–∫—Ü–∏—è —Å–æ–∫—Ä–∞—â–µ–Ω–∞ —Å 534 –¥–æ 385 —Å—Ç—Ä–æ–∫ (-28%, -149 —Å—Ç—Ä–æ–∫)
  - –§–∞–π–ª: `src/ftp_ops.rs:177-574`

- [x] **#8** –ü—É—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ (`ftp_ops.rs`)
  - –°–µ–π—á–∞—Å: `.unwrap_or("")` –ø–µ—Ä–µ–¥–∞—ë—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ login
  - –ù–∞–¥–æ: –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å None –¥–ª—è FTP/FTPS
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–π –æ—à–∏–±–∫–æ–π –¥–ª—è FTP/FTPS –±–µ–∑ –ø–∞—Ä–æ–ª—è
  - SFTP —Å keyfile –º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å –ø–∞—Ä–æ–ª—å (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ)
  - –§–∞–π–ª: `src/ftp_ops.rs:18-35`

---

## üü° –ü—Ä–æ–±–ª–µ–º—ã —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è (7 –ø—É–Ω–∫—Ç–æ–≤)

- [x] **#10** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ
  - –°–µ–π—á–∞—Å: `let _ = log_with_thread(...)` –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ù–∞–¥–æ: Fallback –Ω–∞ stderr –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ stderr –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è "[LOGGING FAILED: {path} {error}]" + –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –§–∞–π–ª: `src/logging.rs:117-145`

- [x] **#11** `FtpError` –∫–∞–∫ –µ–¥–∏–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–∫–∏ (`protocols/mod.rs`)
  - –°–µ–π—á–∞—Å: `pub type FtpError = suppaftp::FtpError;` ‚Äî SFTP –æ—à–∏–±–∫–∏ —Ç–µ—Ä—è—é—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É
  - –ù–∞–¥–æ: –°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π enum —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –¥–ª—è FTP, SFTP, IO, TLS
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**:
    1. –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å "[SFTP]" –∫–æ –≤—Å–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è–º –æ–± –æ—à–∏–±–∫–∞—Ö –≤ SFTP
    2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ "[PROTOCOL] Connecting to..." –ø—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –≤ `connect_and_login`
    3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å thread_id [T0]
  - –ü—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º thread_id –≤ ftp_ops, –∞ –Ω–µ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö
  - –§–∞–π–ª—ã: `src/protocols/sftp.rs:68-272` (–ø—Ä–µ—Ñ–∏–∫—Å—ã), `src/ftp_ops.rs:18-32,42-48,356,376` (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å thread_id)

- [x] **#12** SFTP `nlst` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∞ FTP ‚Äî –Ω–µ—Ç
  - –°–µ–π—á–∞—Å: SFTP –≤—ã–∑—ã–≤–∞–µ—Ç `is_dir()`, FTP/FTPS ‚Äî –Ω–µ—Ç
  - –ù–∞–¥–æ: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ª–∏–±–æ –æ–±–∞ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç, –ª–∏–±–æ –æ–±–∞ –Ω–µ—Ç)
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: FTP/FTPS —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ SIZE –ø—Ä–æ–≤–µ—Ä–∫—É
  - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É 550 –Ω–∞ –∫–æ–º–∞–Ω–¥—É SIZE, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Ö –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å
  - –§–∞–π–ª—ã: `src/protocols/ftp.rs:73-89`, `src/protocols/ftps.rs:175-191`, `src/protocols/sftp.rs:169-181`

- [x] **#13** –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ `--insecure-skip-verify`
  - –°–µ–π—á–∞—Å: `NoCertificateVerification` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–ª—á–∞
  - –ù–∞–¥–æ: –í—ã–≤–µ—Å—Ç–∏ –∑–∞–º–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–ª–∞–≥–∞
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–º–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å emoji ‚ö†Ô∏è –≤ stderr –∏ –ª–æ–≥-—Ñ–∞–π–ª
  - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ FTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –æ—Ç–∫–ª—é—á—ë–Ω–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
  - –§–∞–π–ª: `src/protocols/ftps.rs:101-109`

- [x] **#14** `Config::Drop` zeroize ‚Äî –Ω–µ–ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞
  - –°–µ–π—á–∞—Å: `String` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –¥–æ drop
  - –ù–∞–¥–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `secrecy::Secret<String>` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `secrecy::Secret<String>` –¥–ª—è password_from –∏ password_to
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π zeroize –ø—Ä–∏ drop, –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
  - –§–∞–π–ª: `src/config.rs:44-66`

- [x] **#15** Rename fallback ‚Äî –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
  - –°–µ–π—á–∞—Å: `rm` ‚Üí `rename` —Å –æ–∫–Ω–æ–º –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
  - –ù–∞–¥–æ: –ö–∞–∫ –º–∏–Ω–∏–º—É–º –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ä–∏—Å–∫ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**: –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "RENAME FALLBACK - DATA LOSS RISK"
  - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –æ–∫–Ω–æ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∫—Ä–∞—à–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ FTP (RFC 3659)
  - –§–∞–π–ª: `src/ftp_ops.rs:625-645``

- [x] **#16** Hardcoded –ø—É—Ç–∏ `/tmp` –±–µ–∑ UID (`instance.rs`)
  - –°–µ–π—á–∞—Å: `/tmp/iftpfm2.sock` –∏ `.pid` ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ multi-user
  - –ù–∞–¥–æ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$XDG_RUNTIME_DIR` –∏–ª–∏ –≤–∫–ª—é—á–∞—Ç—å UID –≤ –∏–º—è —Ñ–∞–π–ª–∞
  - **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**:
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_runtime_dir()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç $XDG_RUNTIME_DIR –∏–ª–∏ /tmp
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_lock_paths()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏
    - –° XDG_RUNTIME_DIR: $XDG_RUNTIME_DIR/iftpfm2.{sock,pid}
    - –ë–µ–∑ XDG_RUNTIME_DIR: /tmp/iftpfm2_<uid>.{sock,pid}
  - –§–∞–π–ª: `src/instance.rs:18-52, 162, 319`

---

## ‚ö™ –ú–µ–ª–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è (8 –ø—É–Ω–∫—Ç–æ–≤)

- [ ] **#17** –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ `.as_str()` –≤—ã–∑–æ–≤—ã
  - –°–µ–π—á–∞—Å: `config.login_from.as_str()` ‚Äî `&String` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ deref'–∏—Ç—Å—è
  - –ù–∞–¥–æ: –£–±—Ä–∞—Ç—å `.as_str()`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `&config.login_from`
  - –§–∞–π–ª—ã: `src/ftp_ops.rs:133, 146, 187, 206`

- [ ] **#18** `filename.as_str()` –≤ —Ü–∏–∫–ª–µ
  - –°–µ–π—á–∞—Å: `filename` —É–∂–µ `String`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `.as_str()`
  - –ù–∞–¥–æ: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `&filename`
  - –§–∞–π–ª: `src/ftp_ops.rs:295, 358, 376, 401, 434, 441, 454`

- [ ] **#19** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `format!` –¥–ª—è –ø—É—Ç–µ–π –≤ SFTP
  - –°–µ–π—á–∞—Å: `format!("{}/{}", self.current_dir.trim_end_matches('/'), filename)` –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 6 —Ä–∞–∑
  - –ù–∞–¥–æ: –í—ã–Ω–µ—Å—Ç–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ö–µ–ª–ø–µ—Ä `fn full_path(&self, filename: &str) -> String`
  - –§–∞–π–ª: `src/protocols/sftp.rs:182, 210, 224, 240, 252, 263`

- [ ] **#20** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
  - –°–µ–π—á–∞—Å: –¢–æ–ª—å–∫–æ –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è, regex
  - –ù–∞–¥–æ: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `transfer_files` —Å mock-FTP —Å–µ—Ä–≤–µ—Ä–æ–º
  - –§–∞–π–ª: `src/ftp_ops.rs:592-685`

- [ ] **#21** `process::exit()` –≤ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–º –∫–æ–¥–µ (`cli.rs`)
  - –°–µ–π—á–∞—Å: `parse_args()` –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞–µ—Ç `process::exit(1)`
  - –ù–∞–¥–æ: –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `Result<CliArgs, CliError>`, –≤—ã–∑—ã–≤–∞—Ç—å exit —Ç–æ–ª—å–∫–æ –≤ main
  - –§–∞–π–ª: `src/cli.rs:76, 80, 87, 96, 102, 114, 120, 131, 137, 150, 159, 166`

- [ ] **#22** –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `stdout` (`main.rs`)
  - –°–µ–π—á–∞—Å: –§–ª–∞–≥ `-s` –ø–∞—Ä—Å–∏—Ç—Å—è, –Ω–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å `_` –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
  - –ù–∞–¥–æ: –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –ª–∏–±–æ —É–±—Ä–∞—Ç—å —Ñ–ª–∞–≥
  - –§–∞–π–ª: `src/main.rs:40`

- [ ] **#23** –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è newlines
  - –°–µ–π—á–∞—Å: `.replace("\n", "")` —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (—Å—Ç—Ä–æ–∫–∞ 302)
  - –ù–∞–¥–æ: –õ–∏–±–æ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –≤ `log_with_thread`, –ª–∏–±–æ —É–±—Ä–∞—Ç—å –≤–µ–∑–¥–µ
  - –§–∞–π–ª: `src/ftp_ops.rs:302`

- [ ] **#24** `expect` –≤ runtime-–∫–æ–¥–µ
  - –°–µ–π—á–∞—Å: `expect("Regex pattern should be valid...")` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
  - –ù–∞–¥–æ: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ proper error handling
  - –§–∞–π–ª: `src/ftp_ops.rs:269-270`

- [ ] **#25** –û–ø–µ—á–∞—Ç–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `TransferMode::Binary`
  - –°–µ–π—á–∞—Å: "Binary mode (untransferred)"
  - –ù–∞–¥–æ: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ "untranslated" –∏–ª–∏ "raw"
  - –§–∞–π–ª: `src/protocols/mod.rs:103`

---

## üîµ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] **#26** SFTP keyfile passphrase –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (`sftp.rs`)
  - –°–µ–π—á–∞—Å: `userauth_pubkey_file(user, None, Path::new(keyfile), None)` ‚Äî passphrase –≤—Å–µ–≥–¥–∞ `None`
  - –ù–∞–¥–æ: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `keyfile_pass_from`/`keyfile_pass_to` –≤ `Config`, –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å passphrase
  - –§–∞–π–ª: `src/protocols/sftp.rs:92`
- [ ] **#27** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ age —Ä–∞–≤–Ω–æ–≥–æ 0 (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ age, –µ—Å–ª–∏ age==0)

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```
üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:        [‚ñà‚ñà‚ñà] 3/3
üü† –°–µ—Ä—å—ë–∑–Ω—ã–µ:          [‚ñà‚ñà‚ñà‚ñà] 4/4
üü° –°—Ä–µ–¥–Ω–∏–µ:            [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 7/7
‚ö™ –ú–µ–ª–∫–∏–µ:             [   ] 0/8
üîµ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:     [   ] 0/2
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û (codereview):    [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 14/22
–ò–¢–û–ì–û (–≤—Å–µ–≥–æ):         [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 14/24
```
